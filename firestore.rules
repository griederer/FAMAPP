// Firestore Security Rules for FAMAPP
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // Users collection - only authenticated family members
    match /users/{userId} {
      allow read, write: if request.auth != null 
        && request.auth.uid == userId
        && isAuthorizedUser(request.auth.token.email);
    }
    
    // Todos collection - family members can read/write all todos
    match /todos/{todoId} {
      allow read, write: if request.auth != null 
        && isAuthorizedUser(request.auth.token.email);
    }
    
    // Events collection - family members can read/write all events
    match /events/{eventId} {
      allow read, write: if request.auth != null 
        && isAuthorizedUser(request.auth.token.email);
    }
    
    // Grocery lists collection - family members can read/write all lists
    match /groceries/{listId} {
      allow read, write: if request.auth != null 
        && isAuthorizedUser(request.auth.token.email);
    }
    
    // Helper function to check authorized family members
    function isAuthorizedUser(email) {
      return email in [
        // TODO: Add actual family member emails here
        'gonzalo@example.com',
        'mpaz@example.com', 
        'borja@example.com',
        'melody@example.com'
      ];
    }
  }
}